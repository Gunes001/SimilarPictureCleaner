# Similar Picture Cleaner - 技术文档与使用说明

## 1. 项目概述
Similar Picture Cleaner 是一个用 Go 语言编写的命令行工具，用于识别和处理相似图片。该工具可以扫描指定目录中的图片文件，根据图片相似度对其进行分组，并可选择性地删除重复图片以节省存储空间。

### 主要功能
- 扫描目录中的图片文件（支持 JPG、JPEG、PNG 格式）
- 使用感知哈希算法计算图片相似度
- 按相似度对图片进行分组
- 可选择性地删除重复图片
- 计算删除重复图片后节省的存储空间

## 2. 技术实现

### 2.1 依赖项
- `github.com/corona10/goimagehash`: 用于计算图片感知哈希
- Go 标准库：
  - `image`：图片处理
  - `image/jpeg`：JPEG 图片支持
  - `image/png`：PNG 图片支持
  - `flag`：命令行参数处理

### 2.2 核心算法
1. **图片相似度计算**：
   - 使用感知哈希（Perception Hash）算法
   - 计算两个图片哈希值之间的汉明距离
   - 将距离转换为相似度百分比

2. **图片分组**：
   - 遍历所有图片，将相似度超过阈值的图片分到同一组
   - 使用 map 记录已处理的图片，避免重复处理

## 3. 使用说明

### 3.1 安装
```bash
# 克隆项目
git clone [repository_url]

# 安装依赖
go mod tidy
```

### 3.2 命令行参数
基本语法：
```bash
go run main.go [-d] <directory> <similarity_percentage>
```

参数说明：
- `-d`：可选参数，指定是否删除重复图片
- `directory`：必选参数，要扫描的目录路径
- `similarity_percentage`：必选参数，相似度阈值（0-100）

### 3.3 使用示例
1. **仅查看相似图片**：
```bash
go run main.go /path/to/images 90
```
此命令将显示相似度达到 90% 及以上的图片组。

2. **删除重复图片**：
```bash
go run main.go -d /path/to/images 90
```
此命令将删除相似度达到 90% 及以上的重复图片，并显示节省的空间。

### 3.4 输出说明
程序将输出：
- 相似图片组的列表
- 每组中的图片路径
- 如果使用 `-d` 参数，还将显示删除操作节省的总空间

## 4. 注意事项
1. 使用 `-d` 参数时请谨慎，被删除的文件无法恢复
2. 建议先不使用 `-d` 参数预览结果
3. 相似度阈值建议设置在 80-95 之间
4. 程序仅支持 JPG、JPEG 和 PNG 格式的图片

## 5. 性能考虑
- 图片哈希计算比较耗时，处理大量图片时需要耐心等待
- 程序会将所有图片加载到内存中，处理大量图片时需要注意内存使用

## 6. 错误处理
程序会处理以下错误情况：
- 无效的命令行参数
- 文件读取错误
- 图片解码错误
- 相似度计算错误
- 文件删除错误

## 7. 未来改进方向
1. 添加更多图片格式支持
2. 实现并行处理以提高性能
3. 添加图片预览功能
4. 提供更多相似度算法选择
5. 添加撤销删除功能

## 8. Third-party libraries
- This project uses the following third-party libraries:[github.com/corona10/goimagehash] (BSD 2-Clause License)
